<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gerador PIX</title>
<style>
body {font-family: Arial, sans-serif; background: #f7f7f7; display:flex; justify-content:center; align-items:center; height:100vh; margin:0;}
.container {background:white; padding:30px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); text-align:center; max-width:400px; width:90%;}
h2 {margin-bottom:20px;color:#333;}
input, select {width:100%; padding:10px; font-size:16px; border:1px solid #ccc; border-radius:6px; margin-bottom:15px; box-sizing:border-box;}
button {padding:10px 15px; font-size:14px; margin:5px; background-color:#2c7be5; color:white; border:none; border-radius:6px; cursor:pointer; transition:0.3s;}
button:hover {background-color:#1a5fcc;}
#pixCode {margin-top:15px; word-break: break-all; font-size:14px; color:#333; background:#f3f3f3; padding:10px; border-radius:6px; display:none;}
</style>
</head>
<body>

<a href="index.html" class="voltar-inicio">Home</a>
<style>
.voltar-inicio {
    position: fixed;
    top: 10px;
    left: 10px;
    background-color: #40ae1a;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
    font-size: 14px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    transition: 0.3s;
    z-index: 9999;
}
.voltar-inicio:hover {
    background-color: #359015;
}
</style>  
  
<div class="container">
<h2>Gerador Código PIX</h2>

<label for="valor">Valor (R$)</label>
<input type="number" id="valor" placeholder="Ex: 150.00" step="0.01" />

<label for="nf">Número do Pedido (opcional)</label>
<input type="text" id="nf" placeholder="Ex: 12345" />

<label for="banco">Selecione o banco/chave</label>
<select id="banco">
<option value="vendas@cearasementes.com.br">Stone - Jurídica</option>
<option value="05541695000132">Banco do Brasil - Jurídica</option>
<option value="48426245315">Ivan - Banco do Brasil</option>
</select>

<button onclick="gerarPix()">Gerar PIX</button>
<button onclick="copiarPix()">Copiar PIX</button>
<button onclick="baixarPDF()">Baixar QRCode</button>

<div id="pixCode"></div>
<canvas id="qrCode" style="display:none;"></canvas>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// Configurações fixas
const RECEIVER_NAME = 'Ceara Sementes'; // sem acentos
const RECEIVER_CITY = 'FORTALEZA';
const CURRENCY = '986';
const COUNTRY = 'BR';

let codigoGerado = "";

// TLV helper
function tlv(tag,value){
  const len = new TextEncoder().encode(value).length;
  return tag + String(len).padStart(2,'0') + value;
}

// CRC16 CCITT
function crc16(payload){
  const poly = 0x1021;
  let crc = 0xFFFF;
  const bytes = new TextEncoder().encode(payload);
  for(let i=0;i<bytes.length;i++){
    crc ^= (bytes[i]<<8);
    for(let j=0;j<8;j++){
      crc = (crc & 0x8000)? ((crc<<1)^poly) : (crc<<1);
      crc &=0xFFFF;
    }
  }
  return crc.toString(16).toUpperCase().padStart(4,'0');
}

// Gera payload PIX real
function buildPixPayload(valorStr,chave,txid){
  const valorNum = Number(valorStr.replace(',','.'));
  if(!valorNum || valorNum<=0) throw new Error('Valor inválido');
  const valor = valorNum.toFixed(2);

  // Limita TXID a 25 caracteres e remove caracteres inválidos
  let safeTxid = txid ? txid.replace(/[^0-9A-Za-z\-_.]/g,'').substring(0,25) : '';

  let payload = '';
  payload += tlv('00','01'); // Payload Format Indicator
  let mai = '';
  mai += tlv('00','BR.GOV.BCB.PIX');
  mai += tlv('01',chave);
  payload += tlv('26',mai);
  payload += tlv('52','0000'); // MCC
  payload += tlv('53',CURRENCY); // Currency
  payload += tlv('54',valor); // Amount
  payload += tlv('58',COUNTRY); // Country
  payload += tlv('59',RECEIVER_NAME.substring(0,25)); // Merchant Name
  payload += tlv('60',RECEIVER_CITY.substring(0,15)); // Merchant City
  if(safeTxid) payload += tlv('62', tlv('05',safeTxid)); // Additional Data Field

  const payloadForCrc = payload+'6304';
  const crc = crc16(payloadForCrc);
  payload += tlv('63',crc);

  return payload;
}

// Gera TXID aleatório
function gerarTxid(){
  const chars = 'ABCDEFGHJKMNPQRSTUVWXYZ23456789abcdefghjkmnpqrstuvwxyz';
  let s='';
  for(let i=0;i<10;i++) s+=chars.charAt(Math.floor(Math.random()*chars.length));
  return s;
}

function gerarPix(){
  const valor = document.getElementById('valor').value.trim();
  const nf = document.getElementById('nf').value.trim();
  const chave = document.getElementById('banco').value;
  const txid = nf ? nf : gerarTxid();

  try{
    const payload = buildPixPayload(valor,chave,txid);
    codigoGerado = payload;
    document.getElementById('pixCode').style.display='block';
    document.getElementById('pixCode').innerText = payload;

    new QRious({element:document.getElementById('qrCode'), value: payload, size:200});
  }catch(err){alert(err.message);}
}

function copiarPix(){
  if(!codigoGerado){alert('Gere o código PIX primeiro.'); return;}
  navigator.clipboard.writeText(codigoGerado).then(()=>{alert('Código PIX copiado!');});
}

async function baixarPDF(){
  if(!codigoGerado){alert('Gere o código PIX primeiro.'); return;}
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const canvas = document.getElementById('qrCode');
  const imgData = canvas.toDataURL('image/png');

  const nf = document.getElementById('nf').value.trim();
  const nfTexto = nf ? `NF/Pedido: ${nf}` : "";

  doc.setFontSize(16);
  doc.text("Pagamento via PIX",20,20);
  if(nfTexto) doc.setFontSize(12).text(nfTexto,20,28);
  doc.setFontSize(12);
  doc.text("Escaneie o QR Code ou copie o código abaixo:",20,36);
  doc.addImage(imgData,'PNG',60,45,90,90);
  doc.setFontSize(10);
  doc.text("Código PIX:",20,140);
  doc.setFontSize(8);
  const linhas = doc.splitTextToSize(codigoGerado,170);
  doc.text(linhas,20,146);

  doc.save("Pagamento_PIX.pdf");
}
</script>
</body>
</html>




